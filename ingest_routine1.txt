hydra ingest notes (ERJ 5/15/13)

1) check for eligible oids 
select a.hpid,a.oid,a.cid,a.pid,b.contentModel,a._oid 
from dbo.hydra_publish a,
dbo.hydra_content_model b 
where a.dateHydraStart is null 
and a.dateReady 
is not null and a._oid=0 
and a.hcmid is not null
and a.hcmid=b.hcmid 
order by a.dateReady

from this query get list of hpids for later use, most of the time this will be 'hpid > "somenumber"'

check data in table is OK
  select * from dbo.hydra_publish with hpid > "somenumber"

2a)check existing Collection objects
select distinct cid,pid from dbo.hydra_publish

b)check solr for existing collections
http://libserver3.yale.edu:8983/solr/development/select?fq=has_model_s%3A%22info%3Afedora%2Fafmodel%3ACollection%22&fl=id%2Ccid_i%2Cprojid_i%2Ctitle_s&wt=xml

c)add collections not existing with rake task such as:
cd yul_hydra_head2
bundle exec rake yulhy:add_collection[2,1,"Yale Visual Resources Collection"]

*this step should be replaced later by a batch process

3) run the actual ingest pointing output to a .txt file: 
bundle exec rake yulhy2:ingest > output.txt

4) check output file and sderr for successful ingests, failures, and possible errors

5) check database using hpid from step 1 and report
select a.hpid, b.contentmodel,a.pid,a.oid,a._oid,a.zindex,a.hydraID
from dbo.hydra_publish a,dbo.hydra_content_model b 
where a.hcmid=b.hcmid and a.hpid > <somenumber>

6) debug if necessary (the hard part)
 
